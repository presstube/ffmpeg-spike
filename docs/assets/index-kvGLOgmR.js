var T=Object.defineProperty;var N=r=>{throw TypeError(r)};var C=(r,e,t)=>e in r?T(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>C(r,typeof e!="symbol"?e+"":e,t),U=(r,e,t)=>e.has(r)||N("Cannot "+t);var o=(r,e,t)=>(U(r,e,"read from private field"),t?t.call(r):e.get(r)),u=(r,e,t)=>e.has(r)?N("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),O=(r,e,t,n)=>(U(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const E of a.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&n(E)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var i;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(i||(i={}));const P=(()=>{let r=0;return()=>r++})(),S=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),B=new Error("called FFmpeg.terminate()");var l,h,f,p,m,I,d;class W{constructor(){u(this,l,null);u(this,h,{});u(this,f,{});u(this,p,[]);u(this,m,[]);c(this,"loaded",!1);u(this,I,()=>{o(this,l)&&(o(this,l).onmessage=({data:{id:e,type:t,data:n}})=>{switch(t){case i.LOAD:this.loaded=!0,o(this,h)[e](n);break;case i.MOUNT:case i.UNMOUNT:case i.EXEC:case i.WRITE_FILE:case i.READ_FILE:case i.DELETE_FILE:case i.RENAME:case i.CREATE_DIR:case i.LIST_DIR:case i.DELETE_DIR:o(this,h)[e](n);break;case i.LOG:o(this,p).forEach(s=>s(n));break;case i.PROGRESS:o(this,m).forEach(s=>s(n));break;case i.ERROR:o(this,f)[e](n);break}delete o(this,h)[e],delete o(this,f)[e]})});u(this,d,({type:e,data:t},n=[],s)=>o(this,l)?new Promise((a,E)=>{const R=P();o(this,l)&&o(this,l).postMessage({id:R,type:e,data:t},n),o(this,h)[R]=a,o(this,f)[R]=E,s==null||s.addEventListener("abort",()=>{E(new DOMException(`Message # ${R} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(S));c(this,"load",({classWorkerURL:e,...t}={},{signal:n}={})=>(o(this,l)||(O(this,l,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL(""+new URL("worker-lPYB70QI.js",import.meta.url).href,import.meta.url),{type:"module"})),o(this,I).call(this)),o(this,d).call(this,{type:i.LOAD,data:t},void 0,n)));c(this,"exec",(e,t=-1,{signal:n}={})=>o(this,d).call(this,{type:i.EXEC,data:{args:e,timeout:t}},void 0,n));c(this,"terminate",()=>{const e=Object.keys(o(this,f));for(const t of e)o(this,f)[t](B),delete o(this,f)[t],delete o(this,h)[t];o(this,l)&&(o(this,l).terminate(),O(this,l,null),this.loaded=!1)});c(this,"writeFile",(e,t,{signal:n}={})=>{const s=[];return t instanceof Uint8Array&&s.push(t.buffer),o(this,d).call(this,{type:i.WRITE_FILE,data:{path:e,data:t}},s,n)});c(this,"mount",(e,t,n)=>{const s=[];return o(this,d).call(this,{type:i.MOUNT,data:{fsType:e,options:t,mountPoint:n}},s)});c(this,"unmount",e=>{const t=[];return o(this,d).call(this,{type:i.UNMOUNT,data:{mountPoint:e}},t)});c(this,"readFile",(e,t="binary",{signal:n}={})=>o(this,d).call(this,{type:i.READ_FILE,data:{path:e,encoding:t}},void 0,n));c(this,"deleteFile",(e,{signal:t}={})=>o(this,d).call(this,{type:i.DELETE_FILE,data:{path:e}},void 0,t));c(this,"rename",(e,t,{signal:n}={})=>o(this,d).call(this,{type:i.RENAME,data:{oldPath:e,newPath:t}},void 0,n));c(this,"createDir",(e,{signal:t}={})=>o(this,d).call(this,{type:i.CREATE_DIR,data:{path:e}},void 0,t));c(this,"listDir",(e,{signal:t}={})=>o(this,d).call(this,{type:i.LIST_DIR,data:{path:e}},void 0,t));c(this,"deleteDir",(e,{signal:t}={})=>o(this,d).call(this,{type:i.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?o(this,p).push(t):e==="progress"&&o(this,m).push(t)}off(e,t){e==="log"?O(this,p,o(this,p).filter(n=>n!==t)):e==="progress"&&O(this,m,o(this,m).filter(n=>n!==t))}}l=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,I=new WeakMap,d=new WeakMap;const k=new Error("failed to get response body reader"),j=new Error("failed to complete download"),G="Content-Length",M=async r=>{let e;return/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(r)?e=atob(r.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(r)).arrayBuffer(),new Uint8Array(e)},x=async(r,e)=>{var s;const t=await fetch(r);let n;try{const a=parseInt(t.headers.get(G)||"-1"),E=(s=t.body)==null?void 0:s.getReader();if(!E)throw k;const R=[];let D=0;for(;;){const{done:w,value:b}=await E.read(),_=b?b.length:0;if(w){if(a!=-1&&a!==D)throw j;e&&e({url:r,total:a,received:D,delta:_,done:w});break}R.push(b),D+=_,e&&e({url:r,total:a,received:D,delta:_,done:w})}const A=new Uint8Array(D);let y=0;for(const w of R)A.set(w,y),y+=w.length;n=A.buffer}catch(a){console.log("failed to send download progress event: ",a),n=await t.arrayBuffer()}return n},v=async(r,e,t=!1,n)=>{const s=t?await x(r,n):await(await fetch(r)).arrayBuffer(),a=new Blob([s],{type:e});return URL.createObjectURL(a)};console.log("hello");const L=new W;let g=null;X();async function X(){await $(),await H(),Y()}async function $(){console.log("loading:");const r="./ffmpeg-core";L.on("log",({message:e})=>{console.log(e)}),await L.load({coreURL:await v(`${r}/ffmpeg-core.js`,"text/javascript"),wasmURL:await v(`${r}/ffmpeg-core.wasm`,"application/wasm")}),console.log("ahoy, it's loaded: ",L)}async function H(){await L.writeFile("input.webm",await M("https://raw.githubusercontent.com/ffmpegwasm/testdata/master/Big_Buck_Bunny_180_10s.webm")),await L.exec(["-i","input.webm","output.mp4"]);const r=await L.readFile("output.mp4");g=URL.createObjectURL(new Blob([r.buffer],{type:"video/mp4"})),console.log("videoRef: ",g)}function Y(){var r=document.createElement("video");r.setAttribute("width","640"),r.setAttribute("height","360"),r.setAttribute("controls","true");var e=document.createElement("source");e.setAttribute("src",g),e.setAttribute("type","video/mp4"),r.appendChild(e);var t=document.getElementById("video-container");t.appendChild(r)}
